<!DOCTYPE html>
<html lang="ja">
<head>
  
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-162790219-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-162790219-1');
    </script>
  

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <title>Dockerコンテナのネットワーク構成 - yasakura</title>
  
  <meta name="description" content="モチベーション  Dockerコンテナのネットワークを理解するための足がかりとして，netnsについてまとめたい． Dockerコンテナが構成するネットワークについてまとめたい． -pオプションで何も考えずにポートを外に出すのは危険だよと言いたい  OSI参照モデルで役割を把握しておく OSI参照モデルを覚える必要は無いと思うが，どのレイヤーがどのような役割を行っているのかを理解しておく必要はあると思う．
   レイヤー 呼称 例     L7 アプリケーション層 HTTP,FTP,DNS,SNMP   L6 プレゼンテーション層 HTTP,FTP,DNS,SNMP   L5 セッション層 HTTP,FTP,DNS,SNMP,TCP   L4 トランスポート層 TCP,UDP   L3 インターネット層 IP,ICMP,ARP   L2 リンク層 Ethernet,Wi-Fi   L1 物理層 UTP,STP     L2はブリッジ周辺  Ethernetヘッダの制御．IPパケットに，MACアドレスなどを埋め込んだEthernetヘッダをつける/とる． ブリッジはこの辺．  L3はルーター周辺  IPヘッダの制御．TCPセグメントやICMPセグメントにIPヘッダをつける/とる．  pingやtracerouteはL3で処理される． 経由するルータの数をTTL(Time To Live)として指定することで，TTL=0になるとそのパケットは破棄される．  192.">
  
  <link href=/css/style.css rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;900&display=swap" rel="stylesheet">
  
  <link rel="icon" href="https://yasakura.me/img/favicon.ico">
  
  <link rel="alternate" type="application/atom+xml" href="https://yasakura.me/index.xml" title="yasakura">

  <meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@yasakurara" />
<meta property="og:url" content="https://yasakura.me/post/docker-network/" />
<meta property="og:title" content="Dockerコンテナのネットワーク構成" />
<meta property="og:image" content="https://yasakura.me/img/thumbnail.png" />
</head>
<body>
  <header class="header">
    <div class="title"><a href="https://yasakura.me/">yasakura</a></div>
    <nav id="navigation">
      <ul class="menu">
        <li><a href="https://yasakura.me//about/">ABOUT ME</a></li>
      </ul>
    </nav>
  </header>
<article class="post post-view">
  <header class="post-header">
    
    <p class="post-meta">2020.8.13</p>
    
    <h1 class="post-title">Dockerコンテナのネットワーク構成</h1>
    <ul class="post-author">
      <li>
        <a href="https://twitter.com/yasakurara"><svg id="twitter-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 400"><defs><style>.cls-1{fill:none;}.cls-2{fill:#1da1f2;}</style></defs><title>Twitter_Logo_Blue</title><rect class="cls-1" width="400" height="400"/><path class="cls-2" d="M153.62,301.59c94.34,0,145.94-78.16,145.94-145.94,0-2.22,0-4.43-.15-6.63A104.36,104.36,0,0,0,325,122.47a102.38,102.38,0,0,1-29.46,8.07,51.47,51.47,0,0,0,22.55-28.37,102.79,102.79,0,0,1-32.57,12.45,51.34,51.34,0,0,0-87.41,46.78A145.62,145.62,0,0,1,92.4,107.81a51.33,51.33,0,0,0,15.88,68.47A50.91,50.91,0,0,1,85,169.86c0,.21,0,.43,0,.65a51.31,51.31,0,0,0,41.15,50.28,51.21,51.21,0,0,1-23.16.88,51.35,51.35,0,0,0,47.92,35.62,102.92,102.92,0,0,1-63.7,22A104.41,104.41,0,0,1,75,278.55a145.21,145.21,0,0,0,78.62,23"/></svg>@yasakurara</a>
      </li>
    </ul>
    
    <div class="share">
    <a href="https://twitter.com/share?url=https%3a%2f%2fyasakura.me%2fpost%2fdocker-network%2f&text=Docker%e3%82%b3%e3%83%b3%e3%83%86%e3%83%8a%e3%81%ae%e3%83%8d%e3%83%83%e3%83%88%e3%83%af%e3%83%bc%e3%82%af%e6%a7%8b%e6%88%90 - yasakura" rel="nofollow" target="_blank" class="tw">Twitter</a>
    <a href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fyasakura.me%2fpost%2fdocker-network%2f" class="fb" target="_blank" rel="nofollow">Facebook</a>
    <a href="http://b.hatena.ne.jp/add?mode=confirm&url=https%3a%2f%2fyasakura.me%2fpost%2fdocker-network%2f&title=Docker%e3%82%b3%e3%83%b3%e3%83%86%e3%83%8a%e3%81%ae%e3%83%8d%e3%83%83%e3%83%88%e3%83%af%e3%83%bc%e3%82%af%e6%a7%8b%e6%88%90 - yasakura" class="ht" target="_blank" rel="nofollow">Hatena</a>
</div>
  </header>
  <div class="post-content">
    
<h1>Table of Contents</h1>
<nav id="TableOfContents">
<ul>
<li><a href="#モチベーション">モチベーション</a></li>
<li><a href="#osi参照モデルで役割を把握しておく">OSI参照モデルで役割を把握しておく</a>
<ul>
<li><a href="#l2はブリッジ周辺">L2はブリッジ周辺</a></li>
<li><a href="#l3はルーター周辺">L3はルーター周辺</a></li>
<li><a href="#l4はソケット周辺">L4はソケット周辺</a></li>
<li><a href="#l7-l6-l5はアプリケーション周辺">L7,L6,L5はアプリケーション周辺</a></li>
</ul></li>
<li><a href="#つまり-サーバー-クライアントアプリケーションはl7-l6-l5-l4らへん">つまり，サーバー/クライアントアプリケーションはL7,L6,L5,L4らへん</a>
<ul>
<li><a href="#サーバー側">サーバー側</a></li>
<li><a href="#クライアント側">クライアント側</a></li>
</ul></li>
<li><a href="#ifconfigとかiptablesとかで見ているのはl3-l2らへん">ifconfigとかiptablesとかで見ているのはL3,L2らへん</a></li>
<li><a href="#network-namespace-netns-でホスト内のネットワークを分離する">Network Namespace(netns)でホスト内のネットワークを分離する</a>
<ul>
<li><a href="#network-namespaceをつくってみる">Network Namespaceをつくってみる</a></li>
</ul></li>
<li><a href="#コンテナがデフォルトで構成するネットワーク">コンテナがデフォルトで構成するネットワーク</a>
<ul>
<li><a href="#コンテナへのパケットがiptablesによってどのようにフィルタされ-どのように外に出ていくかを知る">コンテナへのパケットがiptablesによってどのようにフィルタされ，どのように外に出ていくかを知る</a></li>
</ul></li>
<li><a href="#コンテナ用のネットワークをつくる">コンテナ用のネットワークをつくる</a></li>
<li><a href="#publishとexpose">publishとexpose</a></li>
<li><a href="#kubernetesのネットワーク構成">Kubernetesのネットワーク構成</a></li>
</ul>
</nav>

    

<h1 id="モチベーション">モチベーション</h1>

<ul>
<li>Dockerコンテナのネットワークを理解するための足がかりとして，netnsについてまとめたい．</li>
<li>Dockerコンテナが構成するネットワークについてまとめたい．</li>
<li><code>-p</code>オプションで何も考えずにポートを外に出すのは危険だよと言いたい</li>
</ul>

<h1 id="osi参照モデルで役割を把握しておく">OSI参照モデルで役割を把握しておく</h1>

<p>OSI参照モデルを覚える必要は無いと思うが，どのレイヤーがどのような役割を行っているのかを理解しておく必要はあると思う．</p>


    <div class = "table">

<table>
<thead>
<tr>
<th>レイヤー</th>
<th>呼称</th>
<th>例</th>
</tr>
</thead>

<tbody>
<tr>
<td>L7</td>
<td>アプリケーション層</td>
<td>HTTP,FTP,DNS,SNMP</td>
</tr>

<tr>
<td>L6</td>
<td>プレゼンテーション層</td>
<td>HTTP,FTP,DNS,SNMP</td>
</tr>

<tr>
<td>L5</td>
<td>セッション層</td>
<td>HTTP,FTP,DNS,SNMP,TCP</td>
</tr>

<tr>
<td>L4</td>
<td>トランスポート層</td>
<td>TCP,UDP</td>
</tr>

<tr>
<td>L3</td>
<td>インターネット層</td>
<td>IP,ICMP,ARP</td>
</tr>

<tr>
<td>L2</td>
<td>リンク層</td>
<td>Ethernet,Wi-Fi</td>
</tr>

<tr>
<td>L1</td>
<td>物理層</td>
<td>UTP,STP</td>
</tr>
</tbody>
</table>
</div>

<h2 id="l2はブリッジ周辺">L2はブリッジ周辺</h2>

<ul>
<li>Ethernetヘッダの制御．IPパケットに，MACアドレスなどを埋め込んだEthernetヘッダをつける/とる．</li>
<li>ブリッジはこの辺．</li>
</ul>

<h2 id="l3はルーター周辺">L3はルーター周辺</h2>

<ul>
<li>IPヘッダの制御．TCPセグメントやICMPセグメントにIPヘッダをつける/とる．

<ul>
<li><code>ping</code>や<code>traceroute</code>はL3で処理される．</li>
<li>経由するルータの数をTTL(Time To Live)として指定することで，TTL=0になるとそのパケットは破棄される．</li>
</ul></li>
<li>192.168.1.1を255.255.255.0（サブネットマスク）でマスクすると192.168.1.0（ネットワークID）が取り出せる（マスクされなかった部分はホストIDと呼ぶ）．これを192.168.1.1/24（先頭3byteでマスクするという意味）と表現しても良い．

<ul>
<li>ネットワークIDが異なる通信はデフォルトゲートウェイに解決してもらう

<ul>
<li>192.168.1.1/24なクライアントから192.168.1.2/24なサーバーへは，直接問い合わせることができる．</li>
<li>192.168.1.1/24なクライアントから192.168.2.1/24なサーバーへは，ゲートウェイを通って問い合わせる．</li>
</ul></li>
</ul></li>
<li>IPアドレスとMACアドレスを対応付けしたAPRテーブルにより．IPアドレスからMACアドレスを解決したりする．</li>
<li>ルーターはこの辺．</li>
</ul>

<h2 id="l4はソケット周辺">L4はソケット周辺</h2>

<ul>
<li>主にソケットの制御を行う．TCPとかUDPとか．セッション管理的な事も行っているのでL5とラップしている．

<ul>
<li>アプリとポートの紐付け</li>
<li>3way Handshakeによるコネクションの確立</li>
<li>ACKによるパケットの保証と再送</li>
<li>送受信パッファの空き状況による送信パケット数の調整＝フロー制御</li>
<li>受信側でのパケットの整列＝順序制御</li>
<li>パケットロスに対する送信パケット数の調整＝輻輳制御</li>
</ul></li>
</ul>

<h2 id="l7-l6-l5はアプリケーション周辺">L7,L6,L5はアプリケーション周辺</h2>

<ul>
<li>例えばWEBアプリケーションだとすると，

<ul>
<li>HTTPのヘッダにはContent-Type,User-Agent,Cookieが埋め込まれているので，L7,L6,L5の役割をすべて担っていると考えて良い．</li>
<li>HTTPのメソッドはGET/POST/PUT/DELETE/HEAD/OPTIONS/TRACE/CONNECTの8種類あるが，CRUDで大体済む．</li>
</ul></li>
</ul>


    <div class = "table">

<table>
<thead>
<tr>
<th>CRUD</th>
<th>HTTPメソッド</th>
</tr>
</thead>

<tbody>
<tr>
<td>Create</td>
<td>POST/PUT</td>
</tr>

<tr>
<td>Read</td>
<td>GET</td>
</tr>

<tr>
<td>Update</td>
<td>PUT</td>
</tr>

<tr>
<td>Delete</td>
<td>DELETE</td>
</tr>
</tbody>
</table>
</div>

<h1 id="つまり-サーバー-クライアントアプリケーションはl7-l6-l5-l4らへん">つまり，サーバー/クライアントアプリケーションはL7,L6,L5,L4らへん</h1>

<p>以下はC言語での実装例であるが，基本的にはどのサーバー/クライアントアプリケーションもL7,L6,L5,L4らへんを実装したものである．</p>

<h2 id="サーバー側">サーバー側</h2>

<ul>
<li>TCPソケットを作成する．socket()</li>
<li>ソケットに，IPアドレスやポート番号を紐付ける．bind()</li>
<li>コネクションの数を設定し，接続可能状態にする．listen()</li>
<li>以下をループする

<ul>
<li>コネクション確立により，クライアント用ソケットを作成する．accept()</li>
<li>クライアント用ソケットとクライアント間でデータを送受信する．send()/recv()</li>
<li>クライアント用ソケットを閉じて接続終了にする．close()</li>
</ul></li>
<li>ソケットを閉じる．close()</li>
</ul>

<h2 id="クライアント側">クライアント側</h2>

<ul>
<li>DNSによってIPアドレスを解決する．getaddrinfo()</li>
<li>TCPソケットを作成する．socket()</li>
<li>コネクションを確立させる．connect()</li>
<li>サーバーとデータを送受信する．recv()/send()</li>
<li>接続を終了する．close()</li>
</ul>

<h1 id="ifconfigとかiptablesとかで見ているのはl3-l2らへん">ifconfigとかiptablesとかで見ているのはL3,L2らへん</h1>

<p>ここからが本題．L2,L3は物理層であるL1に依存しているため，基本的に，L1-L2-L3は一対一に対応している．しかし，同一のホスト内で異なるIPアドレスを持ったアプリケーションを実行するためには，L3（ルーター）を複数用意する必要があり，場合によっては，L3をまとめるL2（ブリッジ）も複数用意する必要がある．これを実現するには，複数のL2,L3を仮想的に用意できる機能であるnetnsを用いる．</p>

<h1 id="network-namespace-netns-でホスト内のネットワークを分離する">Network Namespace(netns)でホスト内のネットワークを分離する</h1>

<p>Network Namespace(netns)とは，ルーティングテーブルやブリッジなどのホスト内のネットワークスタックを仮想的に分離するLinuxカーネルの機能である．同一のホスト上でプロセス毎にネットワークスタックを設定することができ，分離された空間をNamespaceと呼ぶ．</p>

<h2 id="network-namespaceをつくってみる">Network Namespaceをつくってみる</h2>

<p>まず，<code>ifconfig</code>により，eth0やloなどのインターフェースを確認することができ，ethXは物理的なインターフェースであり，ホスト外からみたIPアドレスを指す．また，loは仮想的なインターフェースであり，ホストからみた自身のIPアドレス(一般的には127.0.0.0/8)を指す．</p>

<p><code>ip netns add &lt;name&gt;</code>により．任意のnamespaceをホストに定義することができる．</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo ip netns add mynamespace
$ ip netns list
mynamespace</code></pre></div>
<p><code>ip netns exec &lt;namespace&gt; &lt;command&gt;</code>により，namespaceと<code>&lt;command&gt;</code>を紐付けることができる．これにより，<code>&lt;command&gt;</code>はホストのネットワークから隔離された状態で実行される．</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo ip netns exec mynamespace sh

<span style="color:#75715e"># ifconfig &lt;=== この時点ではactiveなインターフェースは存在しない</span>

<span style="color:#75715e"># ping 127.0.0.1 &lt;=== loへのpingも通らない</span>
connect: Network is unreachable

<span style="color:#75715e"># ip link set lo up &lt;=== loをupする</span>
<span style="color:#75715e"># ping 127.0.0.1</span>
PING <span style="color:#ae81ff">127</span>.0.0.1 <span style="color:#f92672">(</span><span style="color:#ae81ff">127</span>.0.0.1<span style="color:#f92672">)</span> <span style="color:#ae81ff">56</span><span style="color:#f92672">(</span><span style="color:#ae81ff">84</span><span style="color:#f92672">)</span> bytes of data.
<span style="color:#ae81ff">64</span> bytes from <span style="color:#ae81ff">127</span>.0.0.1: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>.028 ms
<span style="color:#ae81ff">64</span> bytes from <span style="color:#ae81ff">127</span>.0.0.1: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>.032 ms
^C
--- <span style="color:#ae81ff">127</span>.0.0.1 ping statistics ---
<span style="color:#ae81ff">2</span> packets transmitted, <span style="color:#ae81ff">2</span> received, <span style="color:#ae81ff">0</span>% packet loss, time 1005ms
rtt min/avg/max/mdev <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>.028/0.030/0.032/0.002 ms
#
<span style="color:#75715e"># ifconfig</span>
lo: flags<span style="color:#f92672">=</span><span style="color:#ae81ff">73</span>&lt;UP,LOOPBACK,RUNNING&gt;  mtu <span style="color:#ae81ff">65536</span> &lt;<span style="color:#f92672">===</span> loが立ち上がる
        inet <span style="color:#ae81ff">127</span>.0.0.1  netmask <span style="color:#ae81ff">255</span>.0.0.0
        inet6 ::1  prefixlen <span style="color:#ae81ff">128</span>  scopeid 0x10&lt;host&gt;
        loop  txqueuelen <span style="color:#ae81ff">1000</span>  <span style="color:#f92672">(</span>Local Loopback<span style="color:#f92672">)</span>
        RX packets <span style="color:#ae81ff">4</span>  bytes <span style="color:#ae81ff">336</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">336</span>.0 B<span style="color:#f92672">)</span>
        RX errors <span style="color:#ae81ff">0</span>  dropped <span style="color:#ae81ff">0</span>  overruns <span style="color:#ae81ff">0</span>  frame <span style="color:#ae81ff">0</span>
        TX packets <span style="color:#ae81ff">4</span>  bytes <span style="color:#ae81ff">336</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">336</span>.0 B<span style="color:#f92672">)</span>
        TX errors <span style="color:#ae81ff">0</span>  dropped <span style="color:#ae81ff">0</span> overruns <span style="color:#ae81ff">0</span>  carrier <span style="color:#ae81ff">0</span>  collisions <span style="color:#ae81ff">0</span>

<span style="color:#75715e"># exit</span></code></pre></div>
<p>ホストとnamespaceをつなげるためには，仮想的なインターフェースであるVirtual Ethernetのペアを用意する必要がある．</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo ip link add type veth &lt;<span style="color:#f92672">===</span> ホストでveth0/1のペアを用意する．ここではVirtual Ethernetのニックネームをvethとした．
$ ip link
...
<span style="color:#ae81ff">117</span>: veth0@veth1: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu <span style="color:#ae81ff">1500</span> qdisc noop state DOWN mode DEFAULT group default qlen <span style="color:#ae81ff">1000</span>
    link/ether <span style="color:#ae81ff">36</span>:07:ad:3a:ea:0e brd ff:ff:ff:ff:ff:ff
<span style="color:#ae81ff">118</span>: veth1@veth0: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu <span style="color:#ae81ff">1500</span> qdisc noop state DOWN mode DEFAULT group default qlen <span style="color:#ae81ff">1000</span>
    link/ether <span style="color:#ae81ff">96</span>:70:77:07:c0:98 brd ff:ff:ff:ff:ff:ff
    veth0/1のペアが用意された．

$ sudo ip link set veth1 netns mynamespace　&lt;<span style="color:#f92672">===</span> mynamespaceにveth1を持っていく
$ ip link
...
<span style="color:#ae81ff">117</span>: veth0@if118: &lt;BROADCAST,MULTICAST&gt; mtu <span style="color:#ae81ff">1500</span> qdisc noop state DOWN mode DEFAULT group default qlen <span style="color:#ae81ff">1000</span>
    link/ether <span style="color:#ae81ff">36</span>:07:ad:3a:ea:0e brd ff:ff:ff:ff:ff:ff link-netnsid <span style="color:#ae81ff">2</span>
    veth1が見えなくなった．

$ ip address show veth0
<span style="color:#ae81ff">117</span>: veth0@if118: &lt;BROADCAST,MULTICAST&gt; mtu <span style="color:#ae81ff">1500</span> qdisc noop state DOWN group default qlen <span style="color:#ae81ff">1000</span>
    link/ether <span style="color:#ae81ff">36</span>:07:ad:3a:ea:0e brd ff:ff:ff:ff:ff:ff link-netnsid <span style="color:#ae81ff">2</span>
    veth0にはIPアドレスが設定されていないようだ

$ sudo ip addr add <span style="color:#ae81ff">172</span>.19.0.1/24 dev veth0 &lt;<span style="color:#f92672">===</span> veth0にIPアドレスを設定する
$ ip address show veth0
<span style="color:#ae81ff">117</span>: veth0@if118: &lt;BROADCAST,MULTICAST&gt; mtu <span style="color:#ae81ff">1500</span> qdisc noop state DOWN group default qlen <span style="color:#ae81ff">1000</span>
    link/ether <span style="color:#ae81ff">36</span>:07:ad:3a:ea:0e brd ff:ff:ff:ff:ff:ff link-netnsid <span style="color:#ae81ff">2</span>
    inet <span style="color:#ae81ff">172</span>.19.0.1/24 scope global veth0 &lt;<span style="color:#f92672">===</span> IPアドレスが設定された
       valid_lft forever preferred_lft foreve

$ sudo ip link set veth0 up &lt;<span style="color:#f92672">===</span> veth0をactiveにする
$ ip address show veth0
<span style="color:#ae81ff">117</span>: veth0@if118: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu <span style="color:#ae81ff">1500</span> qdisc noqueue state LOWERLAYERDOWN group default qlen <span style="color:#ae81ff">1000</span>
    link/ether <span style="color:#ae81ff">36</span>:07:ad:3a:ea:0e brd ff:ff:ff:ff:ff:ff link-netnsid <span style="color:#ae81ff">2</span>
    inet <span style="color:#ae81ff">172</span>.19.0.1/24 scope global veth0
       valid_lft forever preferred_lft forever
    &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt;によるとUPしたらしい

$ sudo ip netns exec mynamespace bash &lt;<span style="color:#f92672">===</span> mynamespace内でbashを立ち上げる
<span style="color:#75715e"># ifconfig</span>
lo: flags<span style="color:#f92672">=</span><span style="color:#ae81ff">73</span>&lt;UP,LOOPBACK,RUNNING&gt;  mtu <span style="color:#ae81ff">65536</span>
        inet <span style="color:#ae81ff">127</span>.0.0.1  netmask <span style="color:#ae81ff">255</span>.0.0.0
        inet6 ::1  prefixlen <span style="color:#ae81ff">128</span>  scopeid 0x10&lt;host&gt;
        loop  txqueuelen <span style="color:#ae81ff">1000</span>  <span style="color:#f92672">(</span>Local Loopback<span style="color:#f92672">)</span>
        RX packets <span style="color:#ae81ff">20</span>  bytes <span style="color:#ae81ff">1504</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span>.5 KB<span style="color:#f92672">)</span>
        RX errors <span style="color:#ae81ff">0</span>  dropped <span style="color:#ae81ff">0</span>  overruns <span style="color:#ae81ff">0</span>  frame <span style="color:#ae81ff">0</span>
        TX packets <span style="color:#ae81ff">20</span>  bytes <span style="color:#ae81ff">1504</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span>.5 KB<span style="color:#f92672">)</span>
        TX errors <span style="color:#ae81ff">0</span>  dropped <span style="color:#ae81ff">0</span> overruns <span style="color:#ae81ff">0</span>  carrier <span style="color:#ae81ff">0</span>  collisions <span style="color:#ae81ff">0</span>

<span style="color:#75715e"># ip link</span> 
<span style="color:#ae81ff">1</span>: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span style="color:#ae81ff">65536</span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen <span style="color:#ae81ff">1000</span>
    link/loopback <span style="color:#ae81ff">00</span>:00:00:00:00:00 brd <span style="color:#ae81ff">00</span>:00:00:00:00:00
<span style="color:#ae81ff">118</span>: veth1@if117: &lt;BROADCAST,MULTICAST&gt; mtu <span style="color:#ae81ff">1500</span> qdisc noop state DOWN mode DEFAULT group default qlen <span style="color:#ae81ff">1000</span>　&lt;<span style="color:#f92672">===</span> mynamespace内にveth1がつくられている
    link/ether <span style="color:#ae81ff">96</span>:70:77:07:c0:98 brd ff:ff:ff:ff:ff:ff link-netnsid <span style="color:#ae81ff">0</span>
    veth0の片割れがnamespace内で見つかった

<span style="color:#75715e"># sudo ip addr add 172.19.0.2/24 dev veth1 &lt;=== veth1にIPアドレスを設定する</span>
<span style="color:#75715e"># ip addr</span>
<span style="color:#ae81ff">1</span>: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span style="color:#ae81ff">65536</span> qdisc noqueue state UNKNOWN group default qlen <span style="color:#ae81ff">1000</span>
    link/loopback <span style="color:#ae81ff">00</span>:00:00:00:00:00 brd <span style="color:#ae81ff">00</span>:00:00:00:00:00
    inet <span style="color:#ae81ff">127</span>.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
<span style="color:#ae81ff">118</span>: veth1@if117: &lt;BROADCAST,MULTICAST&gt; mtu <span style="color:#ae81ff">1500</span> qdisc noop state DOWN group default qlen <span style="color:#ae81ff">1000</span>
    link/ether <span style="color:#ae81ff">96</span>:70:77:07:c0:98 brd ff:ff:ff:ff:ff:ff link-netnsid <span style="color:#ae81ff">0</span>
    inet <span style="color:#ae81ff">172</span>.19.0.2/24 scope global veth1 &lt;<span style="color:#f92672">===</span> veth1にIPアドレスが設定された
       valid_lft forever preferred_lft forever

<span style="color:#75715e"># ip link set veth1 up</span>
<span style="color:#75715e"># ifconfig</span>
lo: flags<span style="color:#f92672">=</span><span style="color:#ae81ff">73</span>&lt;UP,LOOPBACK,RUNNING&gt;  mtu <span style="color:#ae81ff">65536</span>
        inet <span style="color:#ae81ff">127</span>.0.0.1  netmask <span style="color:#ae81ff">255</span>.0.0.0
        inet6 ::1  prefixlen <span style="color:#ae81ff">128</span>  scopeid 0x10&lt;host&gt;
        loop  txqueuelen <span style="color:#ae81ff">1000</span>  <span style="color:#f92672">(</span>Local Loopback<span style="color:#f92672">)</span>
        RX packets <span style="color:#ae81ff">36</span>  bytes <span style="color:#ae81ff">2672</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">2</span>.6 KB<span style="color:#f92672">)</span>
        RX errors <span style="color:#ae81ff">0</span>  dropped <span style="color:#ae81ff">0</span>  overruns <span style="color:#ae81ff">0</span>  frame <span style="color:#ae81ff">0</span>
        TX packets <span style="color:#ae81ff">36</span>  bytes <span style="color:#ae81ff">2672</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">2</span>.6 KB<span style="color:#f92672">)</span>
        TX errors <span style="color:#ae81ff">0</span>  dropped <span style="color:#ae81ff">0</span> overruns <span style="color:#ae81ff">0</span>  carrier <span style="color:#ae81ff">0</span>  collisions <span style="color:#ae81ff">0</span>

veth1: flags<span style="color:#f92672">=</span><span style="color:#ae81ff">4163</span>&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span style="color:#ae81ff">1500</span> &lt;<span style="color:#f92672">===</span> veth1がactiveなインターフェースとして認識された
        inet <span style="color:#ae81ff">172</span>.19.0.2  netmask <span style="color:#ae81ff">255</span>.255.255.0  broadcast <span style="color:#ae81ff">0</span>.0.0.0
        inet6 fe80::9470:77ff:fe07:c098  prefixlen <span style="color:#ae81ff">64</span>  scopeid 0x20&lt;link&gt;
        ether <span style="color:#ae81ff">96</span>:70:77:07:c0:98  txqueuelen <span style="color:#ae81ff">1000</span>  <span style="color:#f92672">(</span>Ethernet<span style="color:#f92672">)</span>
        RX packets <span style="color:#ae81ff">6</span>  bytes <span style="color:#ae81ff">516</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">516</span>.0 B<span style="color:#f92672">)</span>
        RX errors <span style="color:#ae81ff">0</span>  dropped <span style="color:#ae81ff">0</span>  overruns <span style="color:#ae81ff">0</span>  frame <span style="color:#ae81ff">0</span>
        TX packets <span style="color:#ae81ff">6</span>  bytes <span style="color:#ae81ff">516</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">516</span>.0 B<span style="color:#f92672">)</span>
        TX errors <span style="color:#ae81ff">0</span>  dropped <span style="color:#ae81ff">0</span> overruns <span style="color:#ae81ff">0</span>  carrier <span style="color:#ae81ff">0</span>  collisions <span style="color:#ae81ff">0</span>

<span style="color:#75715e"># ping 172.19.0.1</span>
PING <span style="color:#ae81ff">172</span>.19.0.1 <span style="color:#f92672">(</span><span style="color:#ae81ff">172</span>.19.0.1<span style="color:#f92672">)</span> <span style="color:#ae81ff">56</span><span style="color:#f92672">(</span><span style="color:#ae81ff">84</span><span style="color:#f92672">)</span> bytes of data.
<span style="color:#ae81ff">64</span> bytes from <span style="color:#ae81ff">172</span>.19.0.1: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>.073 ms &lt;<span style="color:#f92672">===</span> ホスト側のveth0との疎通がとれている
<span style="color:#ae81ff">64</span> bytes from <span style="color:#ae81ff">172</span>.19.0.1: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>.070 ms
^C
--- <span style="color:#ae81ff">172</span>.19.0.1 ping statistics ---
<span style="color:#ae81ff">2</span> packets transmitted, <span style="color:#ae81ff">2</span> received, <span style="color:#ae81ff">0</span>% packet loss, time 1010ms
rtt min/avg/max/mdev <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>.070/0.071/0.073/0.008 ms</code></pre></div>
<p>ここまでで，ホスト側からnamespace内のveth1への疎通は取れるようになる．しかし，veth1から172.19.0.0/24以外には出られない．
なぜなら，namespace内のルーティングテーブルには，デフォルトルート（デフォルトゲートウェイ）が設定されていないので，172.19.0.0/24以外の行き先を解決することができないからである．
したがって，namespace内でデフォルトルートを設定することで，namespaceから172.19.0.0/24以外に行くことができる．</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo ip netns exec mynamespace bash
<span style="color:#75715e"># ip route</span>
<span style="color:#ae81ff">172</span>.19.0.0/24 dev veth1 proto kernel scope link src <span style="color:#ae81ff">172</span>.19.0.2

<span style="color:#75715e"># ping 172.17.0.1</span>
connect: Network is unreachable &lt;<span style="color:#f92672">===</span> ホスト側には予め用意した172.17.0.1があるはずだが見つからない

<span style="color:#75715e"># ip route add default via 172.19.0.1 &lt;=== 172.19.0.1をmynamespaceのデフォルトルートにする</span>
<span style="color:#75715e"># ip route</span>
default via <span style="color:#ae81ff">172</span>.19.0.1 dev veth1
<span style="color:#ae81ff">172</span>.19.0.0/24 dev veth1 proto kernel scope link src <span style="color:#ae81ff">172</span>.19.0.2

<span style="color:#75715e"># ping 172.17.0.1</span>
PING <span style="color:#ae81ff">172</span>.17.0.1 <span style="color:#f92672">(</span><span style="color:#ae81ff">172</span>.17.0.1<span style="color:#f92672">)</span> <span style="color:#ae81ff">56</span><span style="color:#f92672">(</span><span style="color:#ae81ff">84</span><span style="color:#f92672">)</span> bytes of data.
<span style="color:#ae81ff">64</span> bytes from <span style="color:#ae81ff">172</span>.17.0.1: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>.047 ms &lt;<span style="color:#f92672">===</span> ホスト側の172.17.0.1が見つかった
<span style="color:#ae81ff">64</span> bytes from <span style="color:#ae81ff">172</span>.17.0.1: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>.054 ms
^C
--- <span style="color:#ae81ff">172</span>.17.0.1 ping statistics ---
<span style="color:#ae81ff">2</span> packets transmitted, <span style="color:#ae81ff">2</span> received, <span style="color:#ae81ff">0</span>% packet loss, time 1013ms
rtt min/avg/max/mdev <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>.047/0.050/0.054/0.007 ms</code></pre></div>
<p>ここまでの設定によって，namespaceとホストを行き来することが可能になるが，ホストのeth0からWAN側へは出られない．
なぜなら，NATの設定をしていないので，IPアドレスの変換が行われないからである．
したがって，ホストのiptableにNATの設定を行うことで，namespaceからWANに行くことが可能になる．</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># ping 185.XXX.XXX.XXX</span>
PING <span style="color:#ae81ff">185</span>.XXX.XXX.XXX <span style="color:#f92672">(</span><span style="color:#ae81ff">185</span>.XXX.XXX.XXX<span style="color:#f92672">)</span> <span style="color:#ae81ff">56</span><span style="color:#f92672">(</span><span style="color:#ae81ff">84</span><span style="color:#f92672">)</span> bytes of data.
^C
--- <span style="color:#ae81ff">185</span>.XXX.XXX.XXX ping statistics ---
<span style="color:#ae81ff">3</span> packets transmitted, <span style="color:#ae81ff">0</span> received, <span style="color:#ae81ff">100</span>% packet loss, time 2032ms &lt;<span style="color:#f92672">===</span> mynamespaceからWANに出られない

$ sudo iptables --table nat --append POSTROUTING --source <span style="color:#ae81ff">172</span>.19.0.0/24 --jump MASQUERADE
$ sudo iptables -vnL -t nat

...
Chain POSTROUTING <span style="color:#f92672">(</span>policy ACCEPT <span style="color:#ae81ff">1</span> packets, <span style="color:#ae81ff">59</span> bytes<span style="color:#f92672">)</span>
 pkts bytes target     prot opt in     out     source               destination
    <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span> MASQUERADE  all  --  *      *       <span style="color:#ae81ff">172</span>.19.0.0/24        <span style="color:#ae81ff">0</span>.0.0.0/0 
    各インターフェースから出ようとする172.19.0.0/24からきたパケットのIPアドレスを，出ようとしたインターフェースのIPアドレスに変換するようにする．
...

<span style="color:#75715e"># ping 185.XXX.XXX.XXX</span>
PING <span style="color:#ae81ff">185</span>.XXX.XXX.XXX <span style="color:#f92672">(</span><span style="color:#ae81ff">185</span>.XXX.XXX.XXX<span style="color:#f92672">)</span> <span style="color:#ae81ff">56</span><span style="color:#f92672">(</span><span style="color:#ae81ff">84</span><span style="color:#f92672">)</span> bytes of data.
<span style="color:#ae81ff">64</span> bytes from <span style="color:#ae81ff">185</span>.XXX.XXX.XXX: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">58</span> time<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>.22 ms
<span style="color:#ae81ff">64</span> bytes from <span style="color:#ae81ff">185</span>.XXX.XXX.XXX: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">58</span> time<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>.04 ms
<span style="color:#ae81ff">64</span> bytes from <span style="color:#ae81ff">185</span>.XXX.XXX.XXX: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">58</span> time<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>.14 ms
^C
--- <span style="color:#ae81ff">185</span>.XXX.XXX.XXX ping statistics ---
<span style="color:#ae81ff">3</span> packets transmitted, <span style="color:#ae81ff">3</span> received, <span style="color:#ae81ff">0</span>% packet loss, time 2006ms &lt;<span style="color:#f92672">===</span> mynamespaceからWANに出られた
rtt min/avg/max/mdev <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>.049/1.474/2.227/0.533 ms</code></pre></div>
<p>一般に，同一のネットワークIDを持つVirtual Ethernetは一つのブリッジでまとめておく．</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo ip link add mybridge type bridge &lt;<span style="color:#f92672">===</span> mybridgeというブリッジを追加する
$ sudo ip link
<span style="color:#ae81ff">117</span>: veth0@if118: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style="color:#ae81ff">1500</span> qdisc noqueue state UP mode DEFAULT group default qlen <span style="color:#ae81ff">1000</span>
    link/ether <span style="color:#ae81ff">36</span>:07:ad:3a:ea:0e brd ff:ff:ff:ff:ff:ff link-netnsid <span style="color:#ae81ff">2</span>
<span style="color:#ae81ff">119</span>: mybridge: &lt;BROADCAST,MULTICAST&gt; mtu <span style="color:#ae81ff">1500</span> qdisc noop state DOWN mode DEFAULT group default qlen <span style="color:#ae81ff">1000</span> &lt;<span style="color:#f92672">===</span> mybridgeが追加された
    link/ether da:09:90:31:b9:c3 brd ff:ff:ff:ff:ff:ff

$ sudo ip link set dev veth0 master mybridge &lt;<span style="color:#f92672">===</span> mybridgeにveth0を接続する
$ sudo ip link show master mybridge
<span style="color:#ae81ff">117</span>: veth0@if118: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style="color:#ae81ff">1500</span> qdisc noqueue master mybridge state UP mode DEFAULT group default qlen <span style="color:#ae81ff">1000</span>
    link/ether <span style="color:#ae81ff">36</span>:07:ad:3a:ea:0e brd ff:ff:ff:ff:ff:ff link-netnsid <span style="color:#ae81ff">2</span>
    mybridgeにveth0が接続された

$ sudo ip link set mybridge up &lt;<span style="color:#f92672">===</span> mybridgeをupする
$ sudo ip link
<span style="color:#ae81ff">117</span>: veth0@if118: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style="color:#ae81ff">1500</span> qdisc noqueue master mybridge state UP mode DEFAULT group default qlen <span style="color:#ae81ff">1000</span>
    link/ether <span style="color:#ae81ff">36</span>:07:ad:3a:ea:0e brd ff:ff:ff:ff:ff:ff link-netnsid <span style="color:#ae81ff">2</span>
<span style="color:#ae81ff">119</span>: mybridge: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style="color:#ae81ff">1500</span> qdisc noqueue state UP mode DEFAULT group default qlen <span style="color:#ae81ff">1000</span> &lt;<span style="color:#f92672">===</span> mybridgeがupした
    link/ether <span style="color:#ae81ff">36</span>:07:ad:3a:ea:0e brd ff:ff:ff:ff:ff:ff

$ sudo ip addr del <span style="color:#ae81ff">172</span>.19.0.1/24 dev veth0 &lt;<span style="color:#f92672">===</span> veth0に割り当てているルートアドレスを消す
$ sudo ip addr add <span style="color:#ae81ff">172</span>.19.0.1/24 dev mybridge &lt;<span style="color:#f92672">===</span> mybridgeにルートアドレスを設定する

<span style="color:#75715e"># ping 172.17.0.1</span>
PING <span style="color:#ae81ff">172</span>.17.0.1 <span style="color:#f92672">(</span><span style="color:#ae81ff">172</span>.17.0.1<span style="color:#f92672">)</span> <span style="color:#ae81ff">56</span><span style="color:#f92672">(</span><span style="color:#ae81ff">84</span><span style="color:#f92672">)</span> bytes of data.
<span style="color:#ae81ff">64</span> bytes from <span style="color:#ae81ff">172</span>.17.0.1: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>.061 ms &lt;<span style="color:#f92672">===</span> mynamespaceから別のホストIDにアクセスできた
<span style="color:#ae81ff">64</span> bytes from <span style="color:#ae81ff">172</span>.17.0.1: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>.079 ms
<span style="color:#ae81ff">64</span> bytes from <span style="color:#ae81ff">172</span>.17.0.1: icmp_seq<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> ttl<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> time<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>.092 ms
^C
--- <span style="color:#ae81ff">172</span>.17.0.1 ping statistics ---
<span style="color:#ae81ff">3</span> packets transmitted, <span style="color:#ae81ff">3</span> received, <span style="color:#ae81ff">0</span>% packet loss, time 2044ms
rtt min/avg/max/mdev <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>.061/0.077/0.092/0.014 ms</code></pre></div>
<p>ここまでで，<code>eth0(ホスト)-bridge-veth(ホスト側)-veth(プロセス側)</code>という構成を実現できた．</p>

<h1 id="コンテナがデフォルトで構成するネットワーク">コンテナがデフォルトで構成するネットワーク</h1>

<p>ここまでやってきたnetnsによるL2,L3の仮想化作業をDockerは自動で行っている．Dockerサービスは<code>docker0</code>というDockerブリッジをデフォルトで用意する．</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker network ls | grep bridge
dcec008f4804        bridge              bridge              local

$ docker network inspect bridge
<span style="color:#f92672">[</span>
    <span style="color:#f92672">{</span>
        <span style="color:#e6db74">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;bridge&#34;</span>,
        <span style="color:#e6db74">&#34;Id&#34;</span>: <span style="color:#e6db74">&#34;dcec008f4804...
</span><span style="color:#e6db74">        &#34;</span>Created<span style="color:#e6db74">&#34;: &#34;</span><span style="color:#ae81ff">2020</span>-07-04T02:51:36.795932003+09:00<span style="color:#e6db74">&#34;,
</span><span style="color:#e6db74">        &#34;</span>Scope<span style="color:#e6db74">&#34;: &#34;</span>local<span style="color:#e6db74">&#34;,
</span><span style="color:#e6db74">        &#34;</span>Driver<span style="color:#e6db74">&#34;: &#34;</span>bridge<span style="color:#e6db74">&#34;,
</span><span style="color:#e6db74">        &#34;</span>EnableIPv6<span style="color:#e6db74">&#34;: false,
</span><span style="color:#e6db74">        &#34;</span>IPAM<span style="color:#e6db74">&#34;: {
</span><span style="color:#e6db74">            &#34;</span>Driver<span style="color:#e6db74">&#34;: &#34;</span>default<span style="color:#e6db74">&#34;,
</span><span style="color:#e6db74">            &#34;</span>Options<span style="color:#e6db74">&#34;: null,
</span><span style="color:#e6db74">            &#34;</span>Config<span style="color:#e6db74">&#34;: [
</span><span style="color:#e6db74">                {
</span><span style="color:#e6db74">                    &#34;</span>Subnet<span style="color:#e6db74">&#34;: &#34;</span><span style="color:#ae81ff">172</span>.17.0.0/16<span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">                }
</span><span style="color:#e6db74">            ]
</span><span style="color:#e6db74">        },
</span><span style="color:#e6db74">        &#34;</span>Internal<span style="color:#e6db74">&#34;: false,
</span><span style="color:#e6db74">        &#34;</span>Attachable<span style="color:#e6db74">&#34;: false,
</span><span style="color:#e6db74">        &#34;</span>Ingress<span style="color:#e6db74">&#34;: false,
</span><span style="color:#e6db74">        &#34;</span>ConfigFrom<span style="color:#e6db74">&#34;: {
</span><span style="color:#e6db74">            &#34;</span>Network<span style="color:#e6db74">&#34;: &#34;&#34;
</span><span style="color:#e6db74">        },
</span><span style="color:#e6db74">        &#34;</span>ConfigOnly<span style="color:#e6db74">&#34;: false,
</span><span style="color:#e6db74">        &#34;</span>Containers<span style="color:#e6db74">&#34;: {},
</span><span style="color:#e6db74">        &#34;</span>Options<span style="color:#e6db74">&#34;: {
</span><span style="color:#e6db74">            &#34;</span>com.docker.network.bridge.default_bridge<span style="color:#e6db74">&#34;: &#34;</span>true<span style="color:#e6db74">&#34;,
</span><span style="color:#e6db74">            &#34;</span>com.docker.network.bridge.enable_icc<span style="color:#e6db74">&#34;: &#34;</span>true<span style="color:#e6db74">&#34;,
</span><span style="color:#e6db74">            &#34;</span>com.docker.network.bridge.enable_ip_masquerade<span style="color:#e6db74">&#34;: &#34;</span>true<span style="color:#e6db74">&#34;,
</span><span style="color:#e6db74">            &#34;</span>com.docker.network.bridge.host_binding_ipv4<span style="color:#e6db74">&#34;: &#34;</span><span style="color:#ae81ff">0</span>.0.0.0<span style="color:#e6db74">&#34;,
</span><span style="color:#e6db74">            &#34;</span>com.docker.network.bridge.name<span style="color:#e6db74">&#34;: &#34;</span>docker0<span style="color:#e6db74">&#34;,
</span><span style="color:#e6db74">            &#34;</span>com.docker.network.driver.mtu<span style="color:#e6db74">&#34;: &#34;</span><span style="color:#ae81ff">1500</span><span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">        },
</span><span style="color:#e6db74">        &#34;</span>Labels<span style="color:#e6db74">&#34;: {}
</span><span style="color:#e6db74">    }
</span><span style="color:#e6db74">]
</span><span style="color:#e6db74">
</span><span style="color:#e6db74"></span>$<span style="color:#e6db74"> ifconfig docker0
</span><span style="color:#e6db74">docker0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500
</span><span style="color:#e6db74">        inet 172.17.0.1  netmask 255.255.0.0  broadcast 172.17.255.255
</span><span style="color:#e6db74">        inet6 ...  prefixlen 64  scopeid 0x20&lt;link&gt;
</span><span style="color:#e6db74">        ether ...  txqueuelen 0  (Ethernet)
</span><span style="color:#e6db74">        RX packets 33329  bytes 4334088 (4.3 MB)
</span><span style="color:#e6db74">        RX errors 0  dropped 0  overruns 0  frame 0
</span><span style="color:#e6db74">        TX packets 155842  bytes 269698810 (269.6 MB)
</span><span style="color:#e6db74">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span></code></pre></div>
<p>ここで，<code>docker exec -it &lt;container&gt; bash</code>などでコンテナを立ち上げると，<code>docker0</code>ブリッジにvethがつくられ，ホストからvethの片割れを確認することができる．</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ bridge link show
<span style="color:#ae81ff">116</span>: veth7cd7c37 state UP @if115: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style="color:#ae81ff">1500</span> master docker0 state forwarding priority <span style="color:#ae81ff">32</span> cost <span style="color:#ae81ff">2</span>

$ ifconfig veth7cd7c37
veth7cd7c37: flags<span style="color:#f92672">=</span><span style="color:#ae81ff">4163</span>&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span style="color:#ae81ff">1500</span>
        inet6 ...  prefixlen <span style="color:#ae81ff">64</span>  scopeid 0x20&lt;link&gt;
        ether ...  txqueuelen <span style="color:#ae81ff">0</span>  <span style="color:#f92672">(</span>Ethernet<span style="color:#f92672">)</span>
        RX packets <span style="color:#ae81ff">0</span>  bytes <span style="color:#ae81ff">0</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span>.0 B<span style="color:#f92672">)</span>
        RX errors <span style="color:#ae81ff">0</span>  dropped <span style="color:#ae81ff">0</span>  overruns <span style="color:#ae81ff">0</span>  frame <span style="color:#ae81ff">0</span>
        TX packets <span style="color:#ae81ff">12</span>  bytes <span style="color:#ae81ff">976</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">976</span>.0 B<span style="color:#f92672">)</span>
        TX errors <span style="color:#ae81ff">0</span>  dropped <span style="color:#ae81ff">0</span> overruns <span style="color:#ae81ff">0</span>  carrier <span style="color:#ae81ff">0</span>  collisions <span style="color:#ae81ff">0</span></code></pre></div>
<p>更に，立ち上げたコンテナプロセスのnamespaceに潜り込むと，コンテナ内のvethを確認することができる．</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker run -it --name hoge -p <span style="color:#ae81ff">8080</span>:80 nginx bash

$ docker inspect hoge
...
            <span style="color:#e6db74">&#34;Pid&#34;</span>: <span style="color:#ae81ff">29942</span>, &lt;<span style="color:#f92672">===</span> コンテナのPID
...

$ sudo ln -fs /proc/29942/ns/net /var/run/netns/container &lt;<span style="color:#f92672">===</span> コンテナ側のnetnsをホストで見れるようにsymbolic linkを張る

$ sudo ip netns exec container bash

<span style="color:#75715e"># ifconfig</span>
eth0: flags<span style="color:#f92672">=</span><span style="color:#ae81ff">4163</span>&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span style="color:#ae81ff">1500</span>
        inet <span style="color:#ae81ff">172</span>.17.0.2  netmask <span style="color:#ae81ff">255</span>.255.0.0  broadcast <span style="color:#ae81ff">172</span>.17.255.255 &lt;<span style="color:#f92672">===</span> コンテナ内のvethが見れた．eth0にリネームされている．
        ether <span style="color:#ae81ff">02</span>:42:ac:11:00:02  txqueuelen <span style="color:#ae81ff">0</span>  <span style="color:#f92672">(</span>Ethernet<span style="color:#f92672">)</span>
        RX packets <span style="color:#ae81ff">15</span>  bytes <span style="color:#ae81ff">1186</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span>.1 KB<span style="color:#f92672">)</span>
        RX errors <span style="color:#ae81ff">0</span>  dropped <span style="color:#ae81ff">0</span>  overruns <span style="color:#ae81ff">0</span>  frame <span style="color:#ae81ff">0</span>
        TX packets <span style="color:#ae81ff">0</span>  bytes <span style="color:#ae81ff">0</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span>.0 B<span style="color:#f92672">)</span>
        TX errors <span style="color:#ae81ff">0</span>  dropped <span style="color:#ae81ff">0</span> overruns <span style="color:#ae81ff">0</span>  carrier <span style="color:#ae81ff">0</span>  collisions <span style="color:#ae81ff">0</span>

lo: flags<span style="color:#f92672">=</span><span style="color:#ae81ff">73</span>&lt;UP,LOOPBACK,RUNNING&gt;  mtu <span style="color:#ae81ff">65536</span>
        inet <span style="color:#ae81ff">127</span>.0.0.1  netmask <span style="color:#ae81ff">255</span>.0.0.0
        loop  txqueuelen <span style="color:#ae81ff">1000</span>  <span style="color:#f92672">(</span>Local Loopback<span style="color:#f92672">)</span>
        RX packets <span style="color:#ae81ff">0</span>  bytes <span style="color:#ae81ff">0</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span>.0 B<span style="color:#f92672">)</span>
        RX errors <span style="color:#ae81ff">0</span>  dropped <span style="color:#ae81ff">0</span>  overruns <span style="color:#ae81ff">0</span>  frame <span style="color:#ae81ff">0</span>
        TX packets <span style="color:#ae81ff">0</span>  bytes <span style="color:#ae81ff">0</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span>.0 B<span style="color:#f92672">)</span>
        TX errors <span style="color:#ae81ff">0</span>  dropped <span style="color:#ae81ff">0</span> overruns <span style="color:#ae81ff">0</span>  carrier <span style="color:#ae81ff">0</span>  collisions <span style="color:#ae81ff">0</span></code></pre></div>
<h2 id="コンテナへのパケットがiptablesによってどのようにフィルタされ-どのように外に出ていくかを知る">コンテナへのパケットがiptablesによってどのようにフィルタされ，どのように外に出ていくかを知る</h2>

<ul>
<li>コンテナでない，ホスト上のプロセスがパケットを扱う場合は，基本的に，<code>PREROUTING &gt; INPUT &gt; プロセス &gt; OUTPUT &gt; POSTROUTING</code>を通る．一方，コンテナはDockerブリッジを介してホストとパケットをやり取りするため，<code>PREROUTING &gt; FORWARD &gt; POSTROUTING</code>を通る．</li>

<li><p>まず，<code>PREROUTING</code>にてWANからきたパケットをコンテナに転送する</p>

<ul>
<li><p><code>sudo iptables -vnL -t nat</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">Chain PREROUTING <span style="color:#f92672">(</span>policy ACCEPT <span style="color:#ae81ff">3424</span> packets, 328K bytes<span style="color:#f92672">)</span>
pkts bytes target     prot opt in     out     source               destination
155K 8069K DOCKER     all  --  *      *       <span style="color:#ae81ff">0</span>.0.0.0/0            <span style="color:#ae81ff">0</span>.0.0.0/0            ADDRTYPE match dst-type LOCAL

Chain DOCKER <span style="color:#f92672">(</span><span style="color:#ae81ff">2</span> references<span style="color:#f92672">)</span>
 pkts bytes target     prot opt in     out     source               destination
    <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span> RETURN     all  --  &lt;Dockerブリッジ&gt; *       <span style="color:#ae81ff">0</span>.0.0.0/0            <span style="color:#ae81ff">0</span>.0.0.0/0
    <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span> RETURN     all  --  docker0 *       <span style="color:#ae81ff">0</span>.0.0.0/0            <span style="color:#ae81ff">0</span>.0.0.0/0
    <span style="color:#ae81ff">7</span>   <span style="color:#ae81ff">368</span> DNAT       tcp  --  !&lt;Dockerブリッジ&gt; *       <span style="color:#ae81ff">0</span>.0.0.0/0            <span style="color:#ae81ff">0</span>.0.0.0/0            tcp dpt:443 to:172.18.0.2:443
    <span style="color:#ae81ff">6</span>   <span style="color:#ae81ff">320</span> DNAT       tcp  --  !&lt;Dockerブリッジ&gt; *       <span style="color:#ae81ff">0</span>.0.0.0/0            <span style="color:#ae81ff">0</span>.0.0.0/0            tcp dpt:80 to:172.18.0.2:80</code></pre></div></li>

<li><p>ローカルをウロウロしているパケット (ADDRTYPE match dst-type LOCAL) なら，DOCKERルールを適用する</p>

<ul>
<li>DOCKERチェインでは，

<ul>
<li>Dockerブリッジまたはdocker0ブリッジから来たパケットに関しては何もしない（RETURN）</li>
<li>DNATにより，Dockerブリッジ以外(eth0つまりWANなど)から来た443/80ポートへのTCPパケットをすべて172.18.0.2:443/80に転送する</li>
</ul></li>
</ul></li>
</ul></li>

<li><p>次に，<code>FORWARD</code>チェインにてコンテナへのパケットをフィルタする</p>

<ul>
<li><code>sudo iptables -vnL</code></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">Chain FORWARD <span style="color:#f92672">(</span>policy DROP <span style="color:#ae81ff">0</span> packets, <span style="color:#ae81ff">0</span> bytes<span style="color:#f92672">)</span>
 pkts bytes target     prot opt in     out     source               destination
 110K  179M DOCKER-USER  all  --  *      *       <span style="color:#ae81ff">0</span>.0.0.0/0            <span style="color:#ae81ff">0</span>.0.0.0/0
 110K  179M DOCKER-ISOLATION-STAGE-1  all  --  *      *       <span style="color:#ae81ff">0</span>.0.0.0/0            <span style="color:#ae81ff">0</span>.0.0.0/0
 <span style="color:#ae81ff">4097</span>  459K ACCEPT     all  --  *      &lt;Dockerブリッジ&gt;  <span style="color:#ae81ff">0</span>.0.0.0/0            <span style="color:#ae81ff">0</span>.0.0.0/0            ctstate RELATED,ESTABLISHED
  <span style="color:#ae81ff">821</span> <span style="color:#ae81ff">43588</span> DOCKER     all  --  *      &lt;Dockerブリッジ&gt;  <span style="color:#ae81ff">0</span>.0.0.0/0            <span style="color:#ae81ff">0</span>.0.0.0/0
 <span style="color:#ae81ff">3917</span> 1085K ACCEPT     all  --  &lt;Dockerブリッジ&gt; !&lt;Dockerブリッジ&gt;  <span style="color:#ae81ff">0</span>.0.0.0/0            <span style="color:#ae81ff">0</span>.0.0.0/0
    <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span> ACCEPT     all  --  &lt;Dockerブリッジ&gt; &lt;Dockerブリッジ&gt;  <span style="color:#ae81ff">0</span>.0.0.0/0            <span style="color:#ae81ff">0</span>.0.0.0/0
 139K  245M ACCEPT     all  --  *      docker0  <span style="color:#ae81ff">0</span>.0.0.0/0            <span style="color:#ae81ff">0</span>.0.0.0/0            ctstate RELATED,ESTABLISHED
 <span style="color:#ae81ff">3086</span>  157K DOCKER     all  --  *      docker0  <span style="color:#ae81ff">0</span>.0.0.0/0            <span style="color:#ae81ff">0</span>.0.0.0/0
<span style="color:#ae81ff">28904</span> 4148K ACCEPT     all  --  docker0 !docker0  <span style="color:#ae81ff">0</span>.0.0.0/0            <span style="color:#ae81ff">0</span>.0.0.0/0
    <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span> ACCEPT     all  --  docker0 docker0  <span style="color:#ae81ff">0</span>.0.0.0/0            <span style="color:#ae81ff">0</span>.0.0.0/0

Chain DOCKER <span style="color:#f92672">(</span><span style="color:#ae81ff">2</span> references<span style="color:#f92672">)</span>
 pkts bytes target     prot opt in     out     source               destination
  <span style="color:#ae81ff">134</span>  <span style="color:#ae81ff">6964</span> ACCEPT     tcp  --  !&lt;Dockerブリッジ&gt; &lt;Dockerブリッジ&gt;  <span style="color:#ae81ff">0</span>.0.0.0/0            <span style="color:#ae81ff">172</span>.18.0.2           tcp dpt:443
  <span style="color:#ae81ff">338</span> <span style="color:#ae81ff">16904</span> ACCEPT     tcp  --  !&lt;Dockerブリッジ&gt; &lt;Dockerブリッジ&gt;  <span style="color:#ae81ff">0</span>.0.0.0/0            <span style="color:#ae81ff">172</span>.18.0.2           tcp dpt:80

Chain DOCKER-ISOLATION-STAGE-1 <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> references<span style="color:#f92672">)</span>
 pkts bytes target     prot opt in     out     source               destination
 <span style="color:#ae81ff">3917</span> 1085K DOCKER-ISOLATION-STAGE-2  all  --  &lt;Dockerブリッジ&gt; !&lt;Dockerブリッジ&gt;  <span style="color:#ae81ff">0</span>.0.0.0/0            <span style="color:#ae81ff">0</span>.0.0.0/0
<span style="color:#ae81ff">28904</span> 4148K DOCKER-ISOLATION-STAGE-2  all  --  docker0 !docker0  <span style="color:#ae81ff">0</span>.0.0.0/0            <span style="color:#ae81ff">0</span>.0.0.0/0
 180K  251M RETURN     all  --  *      *       <span style="color:#ae81ff">0</span>.0.0.0/0            <span style="color:#ae81ff">0</span>.0.0.0/0

Chain DOCKER-ISOLATION-STAGE-2 <span style="color:#f92672">(</span><span style="color:#ae81ff">2</span> references<span style="color:#f92672">)</span>
 pkts bytes target     prot opt in     out     source               destination
    <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span> DROP       all  --  *      &lt;Dockerブリッジ&gt;  <span style="color:#ae81ff">0</span>.0.0.0/0            <span style="color:#ae81ff">0</span>.0.0.0/0
    <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span> DROP       all  --  *      docker0  <span style="color:#ae81ff">0</span>.0.0.0/0            <span style="color:#ae81ff">0</span>.0.0.0/0
<span style="color:#ae81ff">32821</span> 5234K RETURN     all  --  *      *       <span style="color:#ae81ff">0</span>.0.0.0/0            <span style="color:#ae81ff">0</span>.0.0.0/0

Chain DOCKER-USER <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> references<span style="color:#f92672">)</span>
 pkts bytes target     prot opt in     out     source               destination
 180K  251M RETURN     all  --  *      *       <span style="color:#ae81ff">0</span>.0.0.0/0            <span style="color:#ae81ff">0</span>.0.0.0/0</code></pre></div>
<ul>
<li><code>DOCKER-USER</code>チェインは，何よりも先に適用されるルールなので，最も優先したいルールをユーザが自由に定義することができる．</li>
<li><code>DOCKER-ISOLATION-STAGE-1</code>チェインでは，コンテナ間ネットワークに関するルールが定義される，</li>
<li><Dockerブリッジ>に行く確立したパケット(ctstate RELATED,ESTABLISHED)はACCEPTする</li>
<li><Dockerブリッジ>に行く未確立のパケットには<code>DOCKER</code>ルールを適用する

<ul>
<li><Dockerブリッジ>以外から来て<Dockerブリッジ>へ行く，送信先172.18.0.2:443/80なパケットをACCEPT</li>
</ul></li>
<li><Dockerブリッジ>からきて<Dockerブリッジ>以外へ行くパケットをACCEPT</li>
<li><Dockerブリッジ>からきて<Dockerブリッジ>へ行くパケットをACCEPT</li>
<li>docker0についても同様．</li>
</ul></li>

<li><p>最後に，<code>POSTROUTING</code>チェインを経てWANに出ていく</p>

<ul>
<li><p><code>sudo iptables -vnL -t nat</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">Chain POSTROUTING <span style="color:#f92672">(</span>policy ACCEPT <span style="color:#ae81ff">23</span> packets, <span style="color:#ae81ff">1364</span> bytes<span style="color:#f92672">)</span>
 pkts bytes target     prot opt in     out     source               destination
    <span style="color:#ae81ff">6</span>   <span style="color:#ae81ff">418</span> MASQUERADE  all  --  *      !&lt;Dockerブリッジ&gt;  <span style="color:#ae81ff">172</span>.18.0.0/16        <span style="color:#ae81ff">0</span>.0.0.0/0
   <span style="color:#ae81ff">68</span>  <span style="color:#ae81ff">4149</span> MASQUERADE  all  --  *      !docker0  <span style="color:#ae81ff">172</span>.17.0.0/16        <span style="color:#ae81ff">0</span>.0.0.0/0
    <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span> MASQUERADE  tcp  --  *      *       <span style="color:#ae81ff">172</span>.18.0.2           <span style="color:#ae81ff">172</span>.18.0.2           tcp dpt:443
    <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span> MASQUERADE  tcp  --  *      *       <span style="color:#ae81ff">172</span>.18.0.2           <span style="color:#ae81ff">172</span>.18.0.2           tcp dpt:80</code></pre></div></li>

<li><p>MASQUERADEで，Dockerブリッジ以外(eth0つまりWANなど)に行く172.18.0.0/16なパケットは，そのインターフェース(eth0など)のIPに変換する．</p></li>

<li><p>MASQUERADEで，docker0以外(eth0つまりWANなど)に行く172.17.0.0/16なパケットは，そのインターフェース(eth0など)のIPに変換する．</p></li>

<li><p>Dockerブリッジまたはdocker0に行く172.18.0.2なパケットは，送信先も172.18.0.2のまま．</p></li>
</ul></li>
</ul>

<h1 id="コンテナ用のネットワークをつくる">コンテナ用のネットワークをつくる</h1>

<ul>
<li><code>docker run</code>で<code>--net</code>オプションを指定しない場合，または，docker-compose.ymlを利用しない場合はデフォルトのブリッジとして<code>docker0</code>が使われる．

<ul>
<li><code>--net=host</code>とすると，<code>docker0</code>やDockerブリッジを使わずにホストのネットワークを直接使うようになる．</li>
<li>docker-compose.ymlを利用した場合は，ユニークなbridgeが生成される．<code>docker network ls</code>で確認できる．</li>
</ul></li>
<li>コンテナを立ち上げると自動でIPアドレスが振られるが，静的なIPアドレスを設定したい場合は，オリジナルのネットワークを定義することができる．

<ul>
<li><code>docker network create --driver=&lt;driver&gt; --subnet=&lt;subnet&gt; --gateway=&lt;gateway&gt; &lt;network name&gt;</code>

<ul>
<li>ネットワークが作成されると，<code>br-&lt;network id先頭12桁&gt;</code>というブリッジ名がつけられる．</li>
</ul></li>
<li><code>docker run --net=&lt;network name&gt;</code>によって，コンテナが使うネットワークを指定できる．</li>
<li><code>docker network rm &lt;network name&gt;</code>によって，ネットワークを削除できる．</li>
</ul></li>
</ul>

<h1 id="publishとexpose">publishとexpose</h1>

<p><code>docker run</code>で<code>-p</code>(publish)オプションを指定したり，docker-compose.ymlで<code>ports</code>を指定すると，NATテーブルが自動で書き換えられる．これにより，WANとコンテナ間のアクセスが実現する．一方，セキュリティの観点から，80/443番ポートはpublishしたいが，DBコンテナとサーバーコンテナ間のポートはpublishしたくないなどと言った場合は，それぞれのコンテナを立ち上げるときに<code>--expose &lt;port&gt;</code>を指定することで，exposeなportはホスト内のみで有効となる．docker-compose.ymlなら<code>EXPOSE</code>がそれに該当する．</p>

<h1 id="kubernetesのネットワーク構成">Kubernetesのネットワーク構成</h1>

<p>あとで書く</p>

  </div>
  <footer class="post-footer">
    
    <div class="share">
    <a href="https://twitter.com/share?url=https%3a%2f%2fyasakura.me%2fpost%2fdocker-network%2f&text=Docker%e3%82%b3%e3%83%b3%e3%83%86%e3%83%8a%e3%81%ae%e3%83%8d%e3%83%83%e3%83%88%e3%83%af%e3%83%bc%e3%82%af%e6%a7%8b%e6%88%90 - yasakura" rel="nofollow" target="_blank" class="tw">Twitter</a>
    <a href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fyasakura.me%2fpost%2fdocker-network%2f" class="fb" target="_blank" rel="nofollow">Facebook</a>
    <a href="http://b.hatena.ne.jp/add?mode=confirm&url=https%3a%2f%2fyasakura.me%2fpost%2fdocker-network%2f&title=Docker%e3%82%b3%e3%83%b3%e3%83%86%e3%83%8a%e3%81%ae%e3%83%8d%e3%83%83%e3%83%88%e3%83%af%e3%83%bc%e3%82%af%e6%a7%8b%e6%88%90 - yasakura" class="ht" target="_blank" rel="nofollow">Hatena</a>
</div>
  </footer>
</article>


<div class="post-widget">
  <div class="twitter-widget">
    <a class="twitter-timeline" data-lang="en" data-width="300" href="https://twitter.com/yasakurara?ref_src=twsrc%5Etfw">Tweets by yasakurara</a>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</div>


<footer class="footer">
  <nav>
    <ul>
      <li><a href="https://yasakura.me//terms/">Terms of Use</a></li>
    </ul>
  </nav>
  <span>&copy; 2021 yasakura</span>
</footer>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      processEscapes: true
    },
    linebreaks: {
      automatic: true
    }
  });
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>
</body>
</html>

